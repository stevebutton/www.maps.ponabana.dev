/*!
 jQuery wookmark plugin
 @name jquery.wookmark.js
 @author Christoph Ono (chri@sto.ph or @gbks)
 @author Sebastian Helzle (sebastian@helzle.net or @sebobo)
 @version 1.4.6
 @date 01/13/2014
 @category jQuery plugin
 @copyright (c) 2009-2013 Christoph Ono (www.wookmark.com)
 @license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
(function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(b){function a(e){j(function(){var h,k;for(h=0;e.length>h;h++){k=e[h],k.obj.css(k.css)}})}function f(e){return b.trim(e).toLowerCase()}var d,c,g;g=function(h,e){return function(){return h.apply(e,arguments)}},c={align:"center",autoResize:!1,comparator:null,container:b("body"),direction:void 0,ignoreInactiveItems:!0,itemWidth:0,fillEmptySpace:!1,flexibleWidth:0,offset:2,outerOffset:0,onLayoutChanged:void 0,possibleFilters:[],resizeDelay:50,verticalOffset:void 0};var j=window.requestAnimationFrame||function(e){e()};d=function(){function e(h,k){this.handler=h,this.columns=this.containerWidth=this.resizeTimer=null,this.activeItemCount=0,this.itemHeightsDirty=!0,this.placeholders=[],b.extend(!0,this,c,k),this.verticalOffset=this.verticalOffset||this.offset,this.update=g(this.update,this),this.onResize=g(this.onResize,this),this.onRefresh=g(this.onRefresh,this),this.getItemWidth=g(this.getItemWidth,this),this.layout=g(this.layout,this),this.layoutFull=g(this.layoutFull,this),this.layoutColumns=g(this.layoutColumns,this),this.filter=g(this.filter,this),this.clear=g(this.clear,this),this.getActiveItems=g(this.getActiveItems,this),this.refreshPlaceholders=g(this.refreshPlaceholders,this),this.sortElements=g(this.sortElements,this),this.updateFilterClasses=g(this.updateFilterClasses,this),this.updateFilterClasses(),this.autoResize&&b(window).bind("resize.wookmark",this.onResize),this.container.bind("refreshWookmark",this.onRefresh)}return e.prototype.updateFilterClasses=function(){for(var x,u,y,v,m=0,p=0,k=0,w={},q=this.possibleFilters;this.handler.length>m;m++){if(u=this.handler.eq(m),x=u.data("filterClass"),"object"==typeof x&&x.length>0){for(p=0;x.length>p;p++){y=f(x[p]),w[y]||(w[y]=[]),w[y].push(u[0])}}}for(;q.length>k;k++){v=f(q[k]),v in w||(w[v]=[])}this.filterClasses=w},e.prototype.update=function(h){this.itemHeightsDirty=!0,b.extend(!0,this,h)},e.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.itemHeightsDirty=0!==this.flexibleWidth,this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},e.prototype.onRefresh=function(){this.itemHeightsDirty=!0,this.layout()},e.prototype.filter=function(y,F){var z,t,v,k,D,x=[],A=b();if(y=y||[],F=F||"or",y.length){for(t=0;y.length>t;t++){D=f(y[t]),D in this.filterClasses&&x.push(this.filterClasses[D])}if(z=x.length,"or"==F||1==z){for(t=0;z>t;t++){A=A.add(x[t])}}else{if("and"==F){var E,C,B,w=x[0],q=!0;for(t=1;z>t;t++){x[t].length<w.length&&(w=x[t])}for(w=w||[],t=0;w.length>t;t++){for(C=w[t],q=!0,v=0;x.length>v&&q;v++){if(B=x[v],w!=B){for(k=0,E=!1;B.length>k&&!E;k++){E=B[k]==C}q&=E}}q&&A.push(w[t])}}}this.handler.not(A).addClass("inactive")}else{A=this.handler}A.removeClass("inactive"),this.columns=null,this.layout()},e.prototype.refreshPlaceholders=function(t,x){for(var A,v,m,p,k,y,q=this.placeholders.length,w=this.columns.length,z=this.container.innerHeight();w>q;q++){A=b('<div class="wookmark-placeholder"/>').appendTo(this.container),this.placeholders.push(A)}for(y=this.offset+2*parseInt(this.placeholders[0].css("borderLeftWidth"),10),q=0;this.placeholders.length>q;q++){if(A=this.placeholders[q],m=this.columns[q],q>=w||!m[m.length-1]){A.css("display","none")}else{if(v=m[m.length-1],!v){continue}k=v.data("wookmark-top")+v.data("wookmark-height")+this.verticalOffset,p=z-k-y,A.css({position:"absolute",display:p>0?"block":"none",left:q*t+x,top:k,width:t-y,height:p})}}},e.prototype.getActiveItems=function(){return this.ignoreInactiveItems?this.handler.not(".inactive"):this.handler},e.prototype.getItemWidth=function(){var w=this.itemWidth,p=this.container.width()-2*this.outerOffset,u=this.handler.eq(0),x=this.flexibleWidth;if(void 0===this.itemWidth||0===this.itemWidth&&!this.flexibleWidth?w=u.outerWidth():"string"==typeof this.itemWidth&&this.itemWidth.indexOf("%")>=0&&(w=parseFloat(this.itemWidth)/100*p),x){"string"==typeof x&&x.indexOf("%")>=0&&(x=parseFloat(x)/100*p);var q=p+this.offset,l=~~(0.5+q/(x+this.offset)),m=~~(q/(w+this.offset)),k=Math.max(l,m),v=Math.min(x,~~((p-(k-1)*this.offset)/k));w=Math.max(w,v),this.handler.css("width",w)}return w},e.prototype.layout=function(z){if(this.container.is(":visible")){var u,x=this.getItemWidth()+this.offset,A=this.container.width(),v=A-2*this.outerOffset,m=~~((v+this.offset)/x),p=0,k=0,y=0,q=this.getActiveItems(),w=q.length;if(this.itemHeightsDirty||!this.container.data("itemHeightsInitialized")){for(;w>y;y++){u=q.eq(y),u.data("wookmark-height",u.outerHeight())}this.itemHeightsDirty=!1,this.container.data("itemHeightsInitialized",!0)}m=Math.max(1,Math.min(m,w)),p=this.outerOffset,"center"==this.align&&(p+=~~(0.5+(v-(m*x-this.offset))>>1)),this.direction=this.direction||("right"==this.align?"right":"left"),k=z||null===this.columns||this.columns.length!=m||this.activeItemCount!=w?this.layoutFull(x,m,p):this.layoutColumns(x,p),this.activeItemCount=w,this.container.css("height",k),this.fillEmptySpace&&this.refreshPlaceholders(x,p),void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged()}},e.prototype.sortElements=function(h){return"function"==typeof this.comparator?h.sort(this.comparator):h},e.prototype.layoutFull=function(z,E,x){var q,t,i=0,C=0,w=b.makeArray(this.getActiveItems()),y=w.length,D=null,B=null,A=[],v=[],k="left"==this.align?!0:!1;for(this.columns=[],w=this.sortElements(w);E>A.length;){A.push(this.outerOffset),this.columns.push([])}for(;y>i;i++){for(q=b(w[i]),D=A[0],B=0,C=0;E>C;C++){D>A[C]&&(D=A[C],B=C)}q.data("wookmark-top",D),t=x,(B>0||!k)&&(t+=B*z),(v[i]={obj:q,css:{position:"absolute",top:D}}).css[this.direction]=t,A[B]+=q.data("wookmark-height")+this.verticalOffset,this.columns[B].push(q)}return a(v),Math.max.apply(Math,A)},e.prototype.layoutColumns=function(z,w){for(var A,q,k,m,i=[],x=[],p=0,v=0,y=0;this.columns.length>p;p++){for(i.push(this.outerOffset),q=this.columns[p],m=p*z+w,A=i[p],v=0;q.length>v;v++,y++){k=q[v].data("wookmark-top",A),(x[y]={obj:k,css:{top:A}}).css[this.direction]=m,A+=k.data("wookmark-height")+this.verticalOffset}i[p]=A}return a(x),Math.max.apply(Math,i)},e.prototype.clear=function(){clearTimeout(this.resizeTimer),b(window).unbind("resize.wookmark",this.onResize),this.container.unbind("refreshWookmark",this.onRefresh),this.handler.wookmarkInstance=null},e}(),b.fn.wookmark=function(e){return this.wookmarkInstance?this.wookmarkInstance.update(e||{}):this.wookmarkInstance=new d(this,e||{}),this.wookmarkInstance.layout(!0),this.show()}});